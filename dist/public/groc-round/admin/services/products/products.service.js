var GrocRoundAdminProductsService;!function(e){var t=function(){return function(e,t,r,s,c){var o=this;this.$q=e,this.$http=t,this.$timeout=r,this.ToastService=s,this.ContextsService=c,this.urlPrefix="/grocRound/admin/products",this.fixPrices=function(e,t){function r(e){return t?100*e:e/100}if(e.prices&&e.prices.forEach(function(e){e.price=r(e.price)}),e.priceValues)for(var s in["min","max","median","mean"])e.priceValues[s]&&(e.priceValues[s].price=r(e.priceValues[s].price));return e.effectivePrice&&(e.effectivePrice.price=r(e.effectivePrice.price)),e},this.getProducts=function(){return o.progress.getProducts=!0,o.promises.getProducts=o.$q(function(e,t){return o.$http.get(o.urlPrefix+"/getProducts").then(function(e){o.progress.getProducts=!1;var r=e.data;if(r.success)return o.$q(function(e,t){o.$timeout(function(){o.products.length&&(o.products=[]),r.payload.foundProducts.forEach(function(e){o.products.push(o.fixPrices(e))}),e(!0)})});var s=r.message?r.message:"Couldn't get product records";return o.ToastService.showSimple(s),t({message:s})}).catch(function(e){return o.progress.getProducts=!1,o.ToastService.showSimple("Products not found"),t({message:"Products not found"})})}),o.promises.getProducts},this.getProduct=function(e){return o.$http.get(o.urlPrefix+"/getProduct/"+e).then(function(e){var t=e.data;if(t.success)return o.$q.resolve(o.fixPrices(t.payload.foundProduct));var r=t.message?t.message:"Couldn't get product record";return o.ToastService.showSimple(r),o.$q.reject({message:r})}).catch(function(e){return o.progress.getProducts=!1,o.ToastService.showSimple("Product not found"),o.$q.reject({message:"Product not found"})})},this.addProduct=function(e){return e.prices&&e.prices.forEach(function(e){e.price=100*e.price}),e.effectivePrice&&(e.effectivePrice.price=100*e.effectivePrice.price),console.log(e),o.$http.post(o.urlPrefix+"/addProduct",e).then(function(e){var t=e.data;return t.success?(o.$timeout(function(){o.products.push(o.fixPrices(t.payload.addedProduct))}),o.ToastService.showSimple("Product Added"),o.$q.resolve()):o.$q.reject({message:t.message?t.message:""})}).catch(function(e){return e.message?(o.ToastService.showSimple(e.message),o.$q.reject({message:e.message})):(o.ToastService.showSimple("Something went wrong"),o.$q.reject({message:"Something went wrong"}))})},this.updateProduct=function(e,t){return t.prices&&t.prices.forEach(function(e){e.price=100*e.price}),t.effectivePrice&&(t.effectivePrice.price=100*t.effectivePrice.price),o.$http.post(o.urlPrefix+"/updateProduct/"+e,t).then(function(e){var t=e.data;return t.success?(o.$timeout(function(){var e=o.products.filter(function(e){return t.payload.updatedProduct.id===e.id});e.length&&angular.copy(o.fixPrices(t.payload.updatedProduct),o.products[o.products.indexOf(e[0])])}),o.ToastService.showSimple("Product record updated"),o.$q.resolve()):o.$q.reject({message:t.message?t.message:""})}).catch(function(e){return e.message?(o.ToastService.showSimple(e.message),o.$q.reject({message:e.message})):(o.ToastService.showSimple("Something went wrong"),o.$q.reject({message:"Something went wrong"}))})},this.removeProduct=function(e){return o.$http.get(o.urlPrefix+"/deleteProduct/"+e).then(function(t){var r=t.data;return r.success?(o.$timeout(function(){var t=o.products.filter(function(t){return t.id===e});t.length&&o.products.splice(o.products.indexOf(t[0]),1)}),o.ToastService.showSimple("Product record deleted"),o.$q.resolve()):o.$q.reject({message:r.message?r.message:""})}).catch(function(e){return e.message?(o.ToastService.showSimple(e.message),o.$q.reject({message:e.message})):(o.ToastService.showSimple("Something went wrong"),o.$q.reject({message:"Something went wrong"}))})},this.progress={getProducts:!1},this.promises={getProducts:this.$q.resolve(!1)},this.products=[],this.getProducts()}}();e.Service=t}(GrocRoundAdminProductsService||(GrocRoundAdminProductsService={}));