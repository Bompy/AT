var GrocRoundAdminAddEditProductComponent;!function(e){var i=function(){return function(e,i,t,r,o,c,d,s){var n=this;this.$q=e,this.$routeParams=i,this.$location=t,this.$mdDialog=r,this.ToastService=o,this.DialogService=c,this.ProductsService=d,this.AddPriceService=s,this.initMembers=function(){n.promises=n.ProductsService.promises,n.progress=n.ProductsService.progress,n.addDetails={label:"",prices:[],effectivePrice:{price:0}},n.updateDetails={label:"",prices:[],effectivePrice:{price:0}}},this.determineMode=function(){n.$routeParams.productId?(n.editMode=!0,n.productId=n.$routeParams.productId,n.findProductInfo()):n.editMode=!1},this.findProductInfo=function(){n.loading=!0;var e=n.ProductsService.products.filter(function(e){return n.productId===e.id});e.length?(n.copyDetails(e[0]),n.loading=!1):n.ProductsService.getProduct(n.productId).then(function(e){n.copyDetails(e)}).catch(function(e){n.errorMessage=e&&e.message?e.message:"Couldn't get product record"}).finally(function(){n.loading=!1})},this.copyDetails=function(e){n.updateDetails={label:e.label,prices:e.prices,effectivePrice:e.effectivePrice}},this.addProduct=function(){return n.addDetails.label?n.addDetails.prices?(n.adding=!0,n.ProductsService.addProduct(n.addDetails).then(function(e){n.$location.path("/products")}).finally(function(){n.adding=!1})):n.ToastService.showSimple("Prices are missing"):n.ToastService.showSimple("Product label is missing")},this.updateProduct=function(){return n.productId?n.updateDetails.label?n.updateDetails.prices?(n.updating=!0,n.ProductsService.updateProduct(n.productId,n.updateDetails).then(function(e){n.$location.path("/products")}).finally(function(){n.updating=!1})):n.ToastService.showSimple("Product prices are missing"):n.ToastService.showSimple("Product label is missing"):n.ToastService.showSimple("Product ID is missing")},this.addPrice=function(e,i){var t={controller:["$mdDialog",function(e){return n.AddPriceService}],controllerAs:"vm",templateUrl:"/groc-round/admin/services/add-price/add-price.template.html",parent:angular.element(document.body),openFrom:"#"+i,closeTo:"#"+i,clickOutsideToClose:!1};return n.$mdDialog.show(t).then(function(i){if(!i)return n.ToastService.showSimple("Something went wrong adding that price");console.log(e),e?n.addDetails.prices.push(i):n.updateDetails.prices.push(i)})},this.removePrice=function(e,i){if(i)-1!=(t=n.addDetails.prices.indexOf(e))?n.addDetails.prices.splice(t,1):n.ToastService.showSimple("Error");else{var t=n.updateDetails.prices.indexOf(e);-1!=t?n.updateDetails.prices.splice(t,1):n.ToastService.showSimple("Error")}},this.deleteProduct=function(){if(!n.productId)return n.ToastService.showSimple("Product ID is missing");n.deleting=!0,n.DialogService.showConfirm("Delete Product","Are you sure?",null).then(function(e){return e?n.ProductsService.removeProduct(n.productId):n.$q.reject()}).then(function(e){n.$location.path("/products")}).finally(function(){n.deleting=!1})},this.initMembers(),this.determineMode()}}();e.Component=i}(GrocRoundAdminAddEditProductComponent||(GrocRoundAdminAddEditProductComponent={}));