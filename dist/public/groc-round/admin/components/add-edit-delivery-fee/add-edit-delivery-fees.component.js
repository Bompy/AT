var GrocRoundAdminAddEditDeliveryFeeComponent;!function(e){var t=function(){return function(e,t,i,n,s,r,o,d,u,a,l){var c=this;this.$q=e,this.$routeParams=t,this.$location=i,this.ToastService=n,this.DeliveryFeesService=s,this.AutoCompleteService=r,this.SelectService=o,this.ProductsService=d,this.UsersService=u,this.RoundsService=a,this.SuperInfoService=l,this.clearMembers=function(){c.users=[],c.rounds=[],c.products=[],c.userText="",c.roundId="",c.productText="",c.addDetails={user:null,round:null,payment:{identifier:"",amount:0,method:""}},c.updateDetails={round:null,payment:{identifier:"",amount:0,method:""}}},this.determineModeAndGetData=function(){c.$routeParams.deliveryFeeId?(c.editMode=!0,c.loading=!0,c.$q.all([c.getDeliveryFeeInfo(c.$routeParams.deliveryFeeId),c.getRounds()]).finally(function(){c.loading=!1})):(c.editMode=!1,c.$q.all([c.getUsers(),c.getRounds()]).then(function(e){var t=c.$location.search();t&&t.userId&&(c.userText=c.AutoCompleteService.reflectUser(t.userId,c.users)),t&&t.roundId&&(c.roundId=c.AutoCompleteService.reflectRound(t.roundId,c.rounds))}).finally(function(){c.loading=!1}))},this.attachToPromises=function(){c.ProductsService.promises.getProducts.then(function(e){e&&(c.errorMessage=null,c.ProductsService.products.forEach(function(e){c.products.push({productId:e.id,label:e.label})}))}).catch(function(e){c.errorMessage=e&&e.message?e.message:"Couldn't get shops"})},this.getUsers=function(){c.loading=!0,c.UsersService.getUsers().then(function(e){c.users=[],c.SuperInfoService.users(c.UsersService.users).forEach(function(e){c.users.push(e)})}).catch(function(e){c.errorMessage=e&&e.message?e.message:"Couldn't get deliveryFee record"}).finally(function(){c.loading=!1})},this.getRounds=function(){c.loading=!0,c.RoundsService.getRounds().then(function(e){c.rounds=[],e.forEach(function(e){c.rounds.push({roundId:e.id,roundName:e.roundName})})}).catch(function(e){c.errorMessage=e&&e.message?e.message:"Couldn't get deliveryFee record"}).finally(function(){c.loading=!1})},this.getDeliveryFeeInfo=function(e){c.loading=!0,c.DeliveryFeesService.getDeliveryFee(e).then(function(e){c.metaUser=e.user,angular.copy(e.round,c.updateDetails.round),c.AutoCompleteService.reflectRound(e.round.roundId,c.rounds),angular.copy(e.payment,c.updateDetails.payment)}).catch(function(e){c.errorMessage=e&&e.message?e.message:"Couldn't get deliveryFee record"}).finally(function(){c.loading=!1})},this.queryProducts=function(e){c.AutoCompleteService.queryProducts(e,c.products)},this.addDeliveryFee=function(){var e=c.AutoCompleteService.getUser(c.userText,c.users);if(!e)return c.ToastService.showSimple("User info is missing");c.addDetails.user.userId=e.userId,c.addDetails.user.emailAddress=e.emailAddress,e.fullName&&(c.addDetails.user.fullName=e.fullName);var t=c.SelectService.getRound(c.roundId,c.rounds);return t?(c.addDetails.round.roundId=c.roundId,c.addDetails.round.roundName=t.roundName,c.addDetails.payment.identifier?c.addDetails.payment.amount?c.addDetails.payment.method?(c.adding=!0,c.DeliveryFeesService.addDeliveryFee(c.addDetails).then(function(e){c.$location.path("/deliveryFees?userId="+c.addDetails.user.userId)}).finally(function(){c.adding=!1})):c.ToastService.showSimple("Payment method is missing"):c.ToastService.showSimple("Payment amount is missing"):c.ToastService.showSimple("Payment identifier is missing")):c.ToastService.showSimple("Round info is missing")},this.updateDeliveryFee=function(){var e=c.SelectService.getRound(c.roundId,c.rounds);return e?(c.updateDetails.round.roundId=e.roundId,c.updateDetails.round.roundName=e.roundName,c.updateDetails.payment.identifier?c.updateDetails.payment.amount?c.updateDetails.payment.method?(c.updating=!0,c.DeliveryFeesService.updateDeliveryFee(c.$routeParams.deliveryFeeId,c.updateDetails).then(function(e){window.history.back()}).finally(function(){c.updating=!1})):c.ToastService.showSimple("Payment method is missing"):c.ToastService.showSimple("Payment amount is missing"):c.ToastService.showSimple("Payment identifier is missing")):c.ToastService.showSimple("Round info is missing")},this.clearMembers(),this.determineModeAndGetData(),this.attachToPromises()}}();e.Component=t}(GrocRoundAdminAddEditDeliveryFeeComponent||(GrocRoundAdminAddEditDeliveryFeeComponent={}));