var GrocRoundAdminAddEditDeliveryFeeComponent;!function(e){var i=function(){return function(e,i,t,n,r,s,d,o,a,u){var l=this;this.$q=e,this.$routeParams=i,this.$location=t,this.ToastService=n,this.DeliveryFeesService=r,this.AutoCompleteService=s,this.SelectService=d,this.UsersService=o,this.RoundsService=a,this.SuperInfoService=u,this.clearMembers=function(){l.users=[],l.rounds=[],l.userText="",l.roundId="",l.productText="",l.addDetails={user:null,round:null,payment:{identifier:"",amount:0,method:""}},l.updateDetails={round:null,payment:{identifier:"",amount:0,method:""}}},this.determineModeAndGetData=function(){l.$routeParams.deliveryFeeId?(l.editMode=!0,l.loading=!0,l.$q.all([l.getDeliveryFeeInfo(l.$routeParams.deliveryFeeId),l.getRounds()]).finally(function(){l.loading=!1})):(l.editMode=!1,l.loading=!0,l.$q.all([l.getUsers(),l.getRounds()]).then(function(e){var i=l.$location.search();i&&i.userId&&(l.userText=l.AutoCompleteService.reflectUser(i.userId,l.users)),i&&i.roundId&&(l.roundId=l.AutoCompleteService.reflectRound(i.roundId,l.rounds))}).finally(function(){l.loading=!1}))},this.getUsers=function(){return l.UsersService.getUsers().then(function(e){l.users=[],l.SuperInfoService.users(l.UsersService.users).forEach(function(e){l.users.push(e)})}).catch(function(e){l.errorMessage=e&&e.message?e.message:"Couldn't get deliveryFee record"})},this.getRounds=function(){return l.RoundsService.getRounds().then(function(e){l.rounds=[],e.forEach(function(e){l.rounds.push({roundId:e.id,roundName:e.roundName})})}).catch(function(e){l.errorMessage=e&&e.message?e.message:"Couldn't get deliveryFee record"})},this.getDeliveryFeeInfo=function(e){return l.DeliveryFeesService.getDeliveryFee(e).then(function(e){l.metaUser=e.user,angular.copy(e.round,l.updateDetails.round),l.AutoCompleteService.reflectRound(e.round.roundId,l.rounds),angular.copy(e.payment,l.updateDetails.payment)}).catch(function(e){l.errorMessage=e&&e.message?e.message:"Couldn't get deliveryFee record"})},this.addDeliveryFee=function(){var e=l.AutoCompleteService.getUser(l.userText,l.users);if(!e)return l.ToastService.showSimple("User info is missing");l.addDetails.user.userId=e.userId,l.addDetails.user.emailAddress=e.emailAddress,e.fullName&&(l.addDetails.user.fullName=e.fullName);var i=l.SelectService.getRound(l.roundId,l.rounds);return i?(l.addDetails.round.roundId=l.roundId,l.addDetails.round.roundName=i.roundName,l.addDetails.payment.identifier?l.addDetails.payment.amount?l.addDetails.payment.method?(l.adding=!0,l.DeliveryFeesService.addDeliveryFee(l.addDetails).then(function(e){l.$location.path("/deliveryFees?userId="+l.addDetails.user.userId)}).finally(function(){l.adding=!1})):l.ToastService.showSimple("Payment method is missing"):l.ToastService.showSimple("Payment amount is missing"):l.ToastService.showSimple("Payment identifier is missing")):l.ToastService.showSimple("Round info is missing")},this.updateDeliveryFee=function(){var e=l.SelectService.getRound(l.roundId,l.rounds);return e?(l.updateDetails.round.roundId=e.roundId,l.updateDetails.round.roundName=e.roundName,l.updateDetails.payment.identifier?l.updateDetails.payment.amount?l.updateDetails.payment.method?(l.updating=!0,l.DeliveryFeesService.updateDeliveryFee(l.$routeParams.deliveryFeeId,l.updateDetails).then(function(e){window.history.back()}).finally(function(){l.updating=!1})):l.ToastService.showSimple("Payment method is missing"):l.ToastService.showSimple("Payment amount is missing"):l.ToastService.showSimple("Payment identifier is missing")):l.ToastService.showSimple("Round info is missing")},this.clearMembers(),this.determineModeAndGetData()}}();e.Component=i}(GrocRoundAdminAddEditDeliveryFeeComponent||(GrocRoundAdminAddEditDeliveryFeeComponent={}));