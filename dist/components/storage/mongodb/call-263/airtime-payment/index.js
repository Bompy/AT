"use strict";function makeConditions(e){return new Promise(function(n,t){var r={};e.user&&(e.user.userId&&(r["user.userId"]=mongoose.Types.ObjectId(e.user.userId)),e.user.emailAddress&&(r["user.emailAddress"]=e.user.emailAddress),e.user.fullName&&(r["user.fullName"]=e.user.fullName)),e.channelId&&(r.channelId=mongoose.Types.ObjectId(e.channelId)),e.transaction&&(e.transaction.identifier&&(r["transaction.identifier"]=e.transaction.identifier),e.transaction.amount&&(r["transaction.amount"]={},e.transaction.amount.min&&(r["transaction.amount"].$gte=e.transaction.amount.min),e.transaction.amount.max&&(r["transaction.amount"].$lte=e.transaction.amount.max))),e.textSearch&&(r.$text={$search:e.textSearch}),n(r)})}function makeSortCriteria(e){return new Promise(function(n,t){var r;r="amount"===e.criteria?"transaction.amount":e.criteria,"Descending"===e.order&&(r="-"+r),n(r)})}function generateAddDetails(e){var n=[];return e.forEach(function(e){var t={user:{userId:mongoose.Types.ObjectId(e.user.userId),emailAddress:e.user.emailAddress,fullName:e.user.fullName},channelId:mongoose.Types.ObjectId(e.channelId),transaction:{identifier:e.transaction.identifier,amount:e.transaction.amount,method:e.transaction.method}};n.push(t)}),n}function generateUpdateDetails(e,n){return new Promise(function(t,r){n.user&&(n.user.userId&&(e.user.userId=mongoose.Types.ObjectId(n.user.userId)),n.user.emailAddress&&(e.user.emailAddress=n.user.emailAddress),n.user.fullName&&(e.user.fullName=n.user.fullName)),n.channelId&&(e.channelId=mongoose.Types.ObjectId(n.channelId)),n.transaction&&(n.transaction.identifier&&(e.transaction.identifier=n.transaction.identifier),n.transaction.amount&&(e.transaction.amount=n.transaction.amount),n.transaction.method&&(e.transaction.method=n.transaction.method)),t(e)})}function convertToAbstract(e,n){return void 0===n&&(n=!1),this.checkThrow(n).then(function(n){return new Promise(function(n,t){var r=[];e.forEach(function(e){var n={id:e._id.toHexString(),user:{userId:e.user.userId.toHexString(),emailAddress:e.user.emailAddress,fullName:e.user.fullName},channelId:e.channelId.toHexString(),transaction:{identifier:e.transaction.identifier,amount:e.transaction.amount,method:e.transaction.method},createdAt:e.createdAt,updatedAt:e.updatedAt};r.push(n)}),n(r)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,n,t){var r=new generic_event_class_1.default(e,"Call263|AirtimePayment");return new generic_model_class_1.default(r,model_1.MongooseModel,n,t,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};