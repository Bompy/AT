"use strict";function makeConditions(e){return new Promise(function(r,n){var t={};e.userId&&(t.userId=mongoose.Types.ObjectId(e.userId)),e.channelId&&(t.channelId=mongoose.Types.ObjectId(e.channelId)),e.paymentId&&(t.paymentId=mongoose.Types.ObjectId(e.paymentId)),e.transfer&&(e.transfer.identifier&&(t["transfer.identifier"]=e.transfer.identifier),e.transfer.amount&&(t["transfer.amount"]={},e.transfer.amount.min&&(t["transfer.amount"].$gte=e.transfer.amount.min),e.transfer.amount.max&&(t["transfer.amount"].$lte=e.transfer.amount.max)),e.transfer.paymentRecorded&&(t["transfer.paymentRecorded"]=e.transfer.paymentRecorded)),e.textSearch&&(t.$text={$search:e.textSearch}),r(t)})}function makeSortCriteria(e){return new Promise(function(r,n){var t;t="amount"===e.criteria?"transfer.amount":e.criteria,"Descending"===e.order&&(t="-"+t),r(t)})}function generateAddDetails(e){var r=[];return e.forEach(function(e){var n={userId:mongoose.Types.ObjectId(e.userId),channelId:mongoose.Types.ObjectId(e.userId),paymentId:mongoose.Types.ObjectId(e.userId),transfer:{identifier:e.transfer.identifier,amount:e.transfer.amount,paymentRecorded:e.transfer.paymentRecorded}};r.push(n)}),r}function generateUpdateDetails(e,r){return new Promise(function(n,t){r.userId&&(e.userId=mongoose.Types.ObjectId(r.userId)),r.channelId&&(e.channelId=mongoose.Types.ObjectId(r.channelId)),r.paymentId&&(e.paymentId=mongoose.Types.ObjectId(r.paymentId)),r.transfer&&(r.transfer.identifier&&(e.transfer.identifier=r.transfer.identifier),r.transfer.amount&&(e.transfer.amount=r.transfer.amount),r.transfer.paymentRecorded&&(e.transfer.paymentRecorded=r.transfer.paymentRecorded)),n(e)})}function convertToAbstract(e,r){return void 0===r&&(r=!1),this.checkThrow(r).then(function(r){return new Promise(function(r,n){var t=[];e.forEach(function(e){var r={id:e._id.toHexString(),userId:e.userId.toHexString(),channelId:e.channelId.toHexString(),paymentId:e.paymentId.toHexString(),transfer:{identifier:e.transfer.identifier,amount:e.transfer.amount,paymentRecorded:e.transfer.paymentRecorded},createdAt:e.createdAt,updatedAt:e.updatedAt};t.push(r)}),r(t)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,r,n){var t=new generic_event_class_1.default(e,"Call263|AirtimeTransfer");return new generic_model_class_1.default(t,model_1.MongooseModel,r,n,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};