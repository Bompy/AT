"use strict";function makeConditions(e){return new Promise(function(i,c){var r={};e.label&&(r.label=e.label),e.images&&(r.images={$all:e.images}),e.priceValues&&(e.priceValues.min&&(e.priceValues.min.shopId&&(r["priceValues.min.shopId"]=mongoose.Types.ObjectId(e.priceValues.min.shopId)),e.priceValues.min.price&&(r["priceValues.min.price"]={},e.priceValues.min.price.min&&(r["priceValues.min.price"].$gte=e.priceValues.min.price.min),e.priceValues.min.price.max&&(r["priceValues.min.price"].$lte=e.priceValues.min.price.max))),e.priceValues.max&&(e.priceValues.max.shopId&&(r["priceValues.max.shopId"]=mongoose.Types.ObjectId(e.priceValues.max.shopId)),e.priceValues.max.price&&(r["priceValues.max.price"]={},e.priceValues.max.price.min&&(r["priceValues.max.price"].$gte=e.priceValues.max.price.min),e.priceValues.max.price.max&&(r["priceValues.max.price"].$lte=e.priceValues.max.price.max))),e.priceValues.median&&(e.priceValues.median.shopId&&(r["priceValues.median.shopId"]=mongoose.Types.ObjectId(e.priceValues.median.shopId)),e.priceValues.median.price&&(r["priceValues.median.price"]={},e.priceValues.median.price.min&&(r["priceValues.median.price"].$gte=e.priceValues.median.price.min),e.priceValues.median.price.max&&(r["priceValues.median.price"].$lte=e.priceValues.median.price.max))),e.priceValues.mean&&(e.priceValues.mean.shopId&&(r["priceValues.mean.shopId"]=mongoose.Types.ObjectId(e.priceValues.mean.shopId)),e.priceValues.mean.price&&(r["priceValues.mean.price"]={},e.priceValues.mean.price.min&&(r["priceValues.mean.price"].$gte=e.priceValues.mean.price.min),e.priceValues.mean.price.max&&(r["priceValues.mean.price"].$lte=e.priceValues.mean.price.max)))),e.effectivePrice&&(e.effectivePrice.shopId&&(r["effectivePrice.shopId"]=mongoose.Types.ObjectId(e.effectivePrice.shopId)),e.effectivePrice.price&&(r["effectivePrice.price"]={},e.effectivePrice.price.min&&(r["effectivePrice.price"].$gte=e.effectivePrice.price.min),e.effectivePrice.price.max&&(r["effectivePrice.price"].$lte=e.effectivePrice.price.max))),e.textSearch&&(r.$text={$search:e.textSearch}),i(r)})}function makeSortCriteria(e){return new Promise(function(i,c){var r;r="effectivePrice"===e.criteria?"effectivePrice.price":e.criteria,"Descending"===e.order&&(r="-"+r),i(r)})}function generateAddDetails(e){var i=[];return e.forEach(function(e){var c={label:e.label,priceValues:{},prices:[],effectivePrice:{price:e.effectivePrice.price}};e.prices&&(c.prices=[],e.prices.forEach(function(e){c.prices.push({shop:{shopId:mongoose.Types.ObjectId(e.shop.shopId),shopName:e.shop.shopName},quantity:e.quantity,price:e.price})})),e.effectivePrice.shopId&&(c.effectivePrice.shopId=mongoose.Types.ObjectId(e.effectivePrice.shopId)),e.images&&(c.images=e.images),e.priceValues.min&&(c.priceValues.min={shopId:mongoose.Types.ObjectId(e.priceValues.min.shopId),price:e.priceValues.min.price}),e.priceValues.max&&(c.priceValues.max={shopId:mongoose.Types.ObjectId(e.priceValues.max.shopId),price:e.priceValues.max.price}),e.priceValues.median&&(c.priceValues.median={shopId:mongoose.Types.ObjectId(e.priceValues.median.shopId),price:e.priceValues.median.price}),e.priceValues.mean&&(c.priceValues.mean={shopId:mongoose.Types.ObjectId(e.priceValues.mean.shopId),price:e.priceValues.mean.price}),i.push(c)}),i}function generateUpdateDetails(e,i){return new Promise(function(c,r){i.label&&(e.label=i.label),i.images&&(e.images=[],i.images.forEach(function(i){e.images.push(i)})),i.prices&&(e.prices=[],i.prices.forEach(function(i){e.prices.push({shop:{shopId:mongoose.Types.ObjectId(i.shop.shopId),shopName:i.shop.shopName},quantity:i.quantity,price:i.price})})),i.priceValues&&(i.priceValues.min&&(e.priceValues.min.shopId=mongoose.Types.ObjectId(i.priceValues.min.shopId),e.priceValues.min.price=i.priceValues.min.price),i.priceValues.max&&(e.priceValues.max.shopId=mongoose.Types.ObjectId(i.priceValues.max.shopId),e.priceValues.max.price=i.priceValues.max.price),i.priceValues.median&&(e.priceValues.median.shopId=mongoose.Types.ObjectId(i.priceValues.median.shopId),e.priceValues.median.price=i.priceValues.median.price),i.priceValues.mean&&(e.priceValues.mean.shopId=mongoose.Types.ObjectId(i.priceValues.mean.shopId),e.priceValues.mean.price=i.priceValues.mean.price)),i.effectivePrice&&(e.effectivePrice.shopId=mongoose.Types.ObjectId(i.effectivePrice.shopId),e.effectivePrice.price=i.effectivePrice.price),c(e)})}function convertToAbstract(e,i){return void 0===i&&(i=!1),this.checkThrow(i).then(function(i){return new Promise(function(i,c){var r=[];e.forEach(function(e){var i={id:e._id.toHexString(),label:e.label,prices:[],priceValues:{},effectivePrice:{price:e.effectivePrice.price},createdAt:e.createdAt,updatedAt:e.updatedAt};e.effectivePrice.shopId&&(i.effectivePrice.shopId=e.effectivePrice.shopId.toHexString()),e.images&&(i.images=e.images),e.prices&&e.prices.forEach(function(e){i.prices.push({shop:{shopId:e.shop.shopId.toHexString(),shopName:e.shop.shopName},quantity:e.quantity,price:e.price})}),e.priceValues.min&&(i.priceValues.min={shopId:e.priceValues.min.shopId.toHexString(),price:e.priceValues.min.price}),e.priceValues.max&&(i.priceValues.max={shopId:e.priceValues.max.shopId.toHexString(),price:e.priceValues.max.price}),e.priceValues.median&&(i.priceValues.median={shopId:e.priceValues.median.shopId.toHexString(),price:e.priceValues.median.price}),e.priceValues.mean&&(i.priceValues.mean={shopId:e.priceValues.mean.shopId.toHexString(),price:e.priceValues.mean.price}),r.push(i)}),i(r)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,i,c){var r=new generic_event_class_1.default(e,"GrocRound|Product");return new generic_model_class_1.default(r,model_1.MongooseModel,i,c,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};