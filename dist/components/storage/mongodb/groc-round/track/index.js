"use strict";function makeConditions(e){return new Promise(function(t,n){var o={};e.round&&(e.round.roundId&&(o["round.roundId"]=mongoose.Types.ObjectId(e.round.roundId)),e.round.roundName&&(o["round.roundName"]=e.round.roundName)),e.trackName&&(o.trackName=e.trackName),e.contributions&&(e.contributions.installmentValue&&(o["contributions.installmentValue"]={},e.contributions.installmentValue.min&&(o["contributions.installmentValue"].$gte=e.contributions.installmentValue.min),e.contributions.installmentValue.max&&(o["contributions.installmentValue"].$lte=e.contributions.installmentValue.max)),e.contributions.totalValue&&(o["contributions.totalValue"]={},e.contributions.totalValue.min&&(o["contributions.totalValue"].$gte=e.contributions.totalValue.min),e.contributions.totalValue.max&&(o["contributions.totalValue"].$lte=e.contributions.totalValue.max))),e.adminFeePercentage&&(o.adminFeePercentage={},e.adminFeePercentage.min&&(o.adminFeePercentage.$gte=e.adminFeePercentage.min),e.adminFeePercentage.max&&(o.adminFeePercentage.$lte=e.adminFeePercentage.max)),e.products&&(e.products.num&&(o["products.num"]={},e.products.num.min&&(o["products.num"].$gte=e.products.num.min),e.products.num.max&&(o["products.num"].$lte=e.products.num.max)),e.products.value&&(o["products.value"]={},e.products.value.min&&(o["products.value"].$gte=e.products.value.min),e.products.value.max&&(o["products.value"].$lte=e.products.value.max))),e.textSearch&&(o.$text={$search:e.textSearch}),t(o)})}function makeSortCriteria(e){return new Promise(function(t,n){var o;o=e.criteria,"installmentValue"==e.criteria&&(o="contributions.installmentValue"),"contributionsValue"==e.criteria&&(o="contributions.totalValue"),"numProducts"==e.criteria&&(o="products.num"),"valueProducts"==e.criteria&&(o="products.value"),"Descending"===e.order&&(o="-"+o),t(o)})}function generateAddDetails(e){var t=[];return e.forEach(function(e){var n={round:{roundId:mongoose.Types.ObjectId(e.round.roundId),roundName:e.round.roundName},trackName:e.trackName,contributions:{installmentValue:e.contributions.installmentValue,totalValue:e.contributions.totalValue},adminFeePercentage:e.adminFeePercentage,products:{num:e.products.num,value:e.products.value}};t.push(n)}),t}function generateUpdateDetails(e,t){return new Promise(function(n,o){t.round&&(t.round.roundId&&(e.round.roundId=mongoose.Types.ObjectId(t.round.roundId)),t.round.roundName&&(e.round.roundName=t.round.roundName)),t.trackName&&(e.trackName=t.trackName),t.contributions&&(t.contributions.installmentValue&&(e.contributions.installmentValue=t.contributions.installmentValue),t.contributions.totalValue&&(e.contributions.totalValue=t.contributions.totalValue)),t.adminFeePercentage&&(e.adminFeePercentage=t.adminFeePercentage),t.products&&(t.products.num&&(e.products.num=t.products.num),t.products.value&&(e.products.value=t.products.value)),n(e)})}function convertToAbstract(e,t){return void 0===t&&(t=!1),this.checkThrow(t).then(function(t){return new Promise(function(t,n){var o=[];e.forEach(function(e){var t={id:e._id.toHexString(),round:{roundId:e.round.roundId.toHexString(),roundName:e.round.roundName},trackName:e.trackName,contributions:{installmentValue:e.contributions.installmentValue,totalValue:e.contributions.totalValue},adminFeePercentage:e.adminFeePercentage,products:{num:e.products.num,value:e.products.value},createdAt:e.createdAt,updatedAt:e.updatedAt};o.push(t)}),t(o)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,t,n){var o=new generic_event_class_1.default(e,"GrocRound|Track");return new generic_model_class_1.default(o,model_1.MongooseModel,t,n,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};