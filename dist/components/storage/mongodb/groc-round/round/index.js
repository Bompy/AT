"use strict";function makeConditions(e){return new Promise(function(n,t){var r={};e.roundName&&(r.roundName=e.roundName),e.inProgress&&(r.inProgress=e.inProgress),e.duration&&(e.duration.start&&(r["duration.start"]={},e.duration.start.min&&(r["duration.start"].$gte=e.duration.start.min),e.duration.start.max&&(r["duration.start"].$lte=e.duration.start.max)),e.duration.end&&(r["duration.end"]={},e.duration.end.min&&(r["duration.end"].$gte=e.duration.end.min),e.duration.end.max&&(r["duration.end"].$lte=e.duration.end.max)),e.duration.months&&(r["duration.months"]={},e.duration.months.min&&(r["duration.months"].$gte=e.duration.months.min),e.duration.months.max&&(r["duration.months"].$lte=e.duration.months.max))),e.deliveries&&(e.deliveries.fee&&(r["deliveries.fee"]={},e.deliveries.fee.min&&(r["deliveries.fee"].$gte=e.deliveries.fee.min),e.deliveries.fee.max&&(r["deliveries.fee"].$lte=e.deliveries.fee.max)),e.deliveries.numPayments&&(r["deliveries.numPayments"]={},e.deliveries.numPayments.min&&(r["deliveries.numPayments"].$gte=e.deliveries.numPayments.min),e.deliveries.numPayments.max&&(r["deliveries.numPayments"].$lte=e.deliveries.numPayments.max)),e.deliveries.valuePayments&&(r["deliveries.valuePayments"]={},e.deliveries.valuePayments.min&&(r["deliveries.valuePayments"].$gte=e.deliveries.valuePayments.min),e.deliveries.valuePayments.max&&(r["deliveries.valuePayments"].$lte=e.deliveries.valuePayments.max))),e.contributions&&(e.contributions.num&&(r["contributions.num"]={},e.contributions.num.min&&(r["contributions.num"].$gte=e.contributions.num.min),e.contributions.num.max&&(r["contributions.num"].$lte=e.contributions.num.max)),e.contributions.value&&(r["contributions.value"]={},e.contributions.value.min&&(r["contributions.value"].$gte=e.contributions.value.min),e.contributions.value.max&&(r["contributions.value"].$lte=e.contributions.value.max))),e.numTracks&&(r.numTracks={},e.numTracks.min&&(r.numTracks.$gte=e.numTracks.min),e.numTracks.max&&(r.numTracks.$lte=e.numTracks.max)),e.valueCartProducts&&(r.valueCartProducts={},e.valueCartProducts.min&&(r.valueCartProducts.$gte=e.valueCartProducts.min),e.valueCartProducts.max&&(r.valueCartProducts.$lte=e.valueCartProducts.max)),e.textSearch&&(r.$text={$search:e.textSearch}),n(r)})}function makeSortCriteria(e){return new Promise(function(n,t){var r;r=e.criteria,"Descending"===e.order&&(r="-"+r),n(r)})}function generateAddDetails(e){var n=[];return e.forEach(function(e){var t={roundName:e.roundName,inProgress:e.inProgress,duration:{start:e.duration.start,end:e.duration.end,months:e.duration.months},deliveries:{fee:e.deliveries.fee,numPayments:e.deliveries.numPayments,valuePayments:e.deliveries.valuePayments},contributions:{num:e.contributions.num,value:e.contributions.value},numTracks:e.numTracks,valueCartProducts:e.valueCartProducts};n.push(t)}),n}function generateUpdateDetails(e,n){return new Promise(function(t,r){n.roundName&&(e.roundName=n.roundName),n.inProgress&&(e.inProgress=n.inProgress),n.duration&&(n.duration.start&&(e.duration.start=n.duration.start),n.duration.end&&(e.duration.end=n.duration.end),n.duration.months&&(e.duration.months=n.duration.months)),n.deliveries&&(n.deliveries.fee&&(e.deliveries.fee=n.deliveries.fee),n.deliveries.numPayments&&(e.deliveries.numPayments=n.deliveries.numPayments),n.deliveries.valuePayments&&(e.deliveries.valuePayments=n.deliveries.valuePayments)),n.contributions&&(n.contributions.num&&(e.contributions.num=n.contributions.num),n.contributions.value&&(e.contributions.value=n.contributions.value)),n.numTracks&&(e.numTracks=n.numTracks),n.valueCartProducts&&(e.valueCartProducts=n.valueCartProducts),t(e)})}function convertToAbstract(e,n){return void 0===n&&(n=!1),this.checkThrow(n).then(function(n){return new Promise(function(n,t){var r=[];e.forEach(function(e){var n={id:e._id.toHexString(),roundName:e.roundName,inProgress:e.inProgress,duration:{start:e.duration.start,end:e.duration.end,months:e.duration.months},deliveries:{fee:e.deliveries.fee,numPayments:e.deliveries.numPayments,valuePayments:e.deliveries.valuePayments},contributions:{num:e.contributions.num,value:e.contributions.value},numTracks:e.numTracks,valueCartProducts:e.valueCartProducts,createdAt:e.createdAt,updatedAt:e.updatedAt};r.push(n)}),n(r)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,n,t){var r=new generic_event_class_1.default(e,"GrocRound|Round");return new generic_model_class_1.default(r,model_1.MongooseModel,n,t,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};