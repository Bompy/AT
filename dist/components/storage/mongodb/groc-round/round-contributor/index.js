"use strict";function makeConditions(e){return new Promise(function(t,u){var r={};e.user&&(e.user.userId&&(r["user.userId"]=mongoose.Types.ObjectId(e.user.userId)),e.user.emailAddress&&(r["user.emailAddress"]=e.user.emailAddress),e.user.fullName&&(r["user.fullName"]=e.user.fullName)),e.round&&(e.round.roundId&&(r["round.roundId"]=mongoose.Types.ObjectId(e.round.roundId)),e.round.roundName&&(r["round.roundName"]=e.round.roundName)),e.contributions&&(e.contributions.num&&(r["contributions.num"]={},e.contributions.num.min&&(r["contributions.num"].$gte=e.contributions.num.min),e.contributions.num.max&&(r["contributions.num"].$lte=e.contributions.num.max)),e.contributions.value&&(r["contributions.value"]={},e.contributions.value.min&&(r["contributions.value"].$gte=e.contributions.value.min),e.contributions.value.max&&(r["contributions.value"].$lte=e.contributions.value.max)),e.contributions.valueDue&&(r["contributions.valueDue"]={},e.contributions.valueDue.min&&(r["contributions.valueDue"].$gte=e.contributions.valueDue.min),e.contributions.valueDue.max&&(r["contributions.valueDue"].$lte=e.contributions.valueDue.max))),e.cart&&(e.cart.num&&(r["cart.num"]={},e.cart.num.min&&(r["cart.num"].$gte=e.cart.num.min),e.cart.num.max&&(r["cart.num"].$lte=e.cart.num.max)),e.cart.value&&(r["cart.value"]={},e.cart.value.min&&(r["cart.value"].$gte=e.cart.value.min),e.cart.value.max&&(r["cart.value"].$lte=e.cart.value.max))),e.deliveryFees&&(e.deliveryFees.valuePaid&&(r["deliveryFees.valuePaid"]={},e.deliveryFees.valuePaid.min&&(r["deliveryFees.valuePaid"].$gte=e.deliveryFees.valuePaid.min),e.deliveryFees.valuePaid.max&&(r["deliveryFees.valuePaid"].$lte=e.deliveryFees.valuePaid.max)),e.deliveryFees.valueDue&&(r["deliveryFees.valueDue"]={},e.deliveryFees.valueDue.min&&(r["deliveryFees.valueDue"].$gte=e.deliveryFees.valueDue.min),e.deliveryFees.valueDue.max&&(r["deliveryFees.valueDue"].$lte=e.deliveryFees.valueDue.max))),e.complete&&(r.complete=e.complete),e.textSearch&&(r.$text={$search:e.textSearch}),t(r)})}function makeSortCriteria(e){return new Promise(function(t,u){var r;r=e.criteria,"numContributions"==e.criteria&&(r="contributions.num"),"valueContributions"==e.criteria&&(r="contributions.value"),"valueDueContributions"==e.criteria&&(r="contributions.valueDue"),"cartNum"==e.criteria&&(r="cart.num"),"cartValue"==e.criteria&&(r="cart.value"),"deliveryFeesPaid"==e.criteria&&(r="deliveryFees.valuePaid"),"deliveryFeesDue"==e.criteria&&(r="deliveryFees.valueDue"),"Descending"===e.order&&(r="-"+r),t(r)})}function generateAddDetails(e){var t=[];return e.forEach(function(e){var u={user:{userId:mongoose.Types.ObjectId(e.user.userId),emailAddress:e.user.emailAddress},round:{roundId:mongoose.Types.ObjectId(e.round.roundId),roundName:e.round.roundName},contributions:{num:e.contributions.num,value:e.contributions.value,valueDue:e.contributions.valueDue},tracks:[],cart:{num:e.cart.num,value:e.cart.value},deliveryFees:{valuePaid:e.deliveryFees.valuePaid,valueDue:e.deliveryFees.valueDue},complete:e.complete};e.tracks&&e.tracks.forEach(function(e){var t={track:{trackId:mongoose.Types.ObjectId(e.track.trackId),trackName:e.track.trackName},deviations:{additions:[],subtractions:[]}};e.deviations.additions&&e.deviations.additions.forEach(function(e){t.deviations.additions.push({product:{productId:mongoose.Types.ObjectId(e.product.productId),label:e.product.label},quantity:e.quantity,value:e.value})}),e.deviations.subtractions&&e.deviations.subtractions.forEach(function(e){t.deviations.subtractions.push({product:{productId:mongoose.Types.ObjectId(e.product.productId),label:e.product.label},quantity:e.quantity,value:e.value})}),u.tracks.push()}),t.push(u)}),t}function generateUpdateDetails(e,t){return new Promise(function(u,r){t.user&&(t.user.userId&&(e.user.userId=mongoose.Types.ObjectId(t.user.userId)),t.user.emailAddress&&(e.user.emailAddress=t.user.emailAddress),t.user.fullName&&(e.user.fullName=t.user.fullName)),t.round&&(t.round.roundId&&(e.round.roundId=mongoose.Types.ObjectId(t.round.roundId)),t.round.roundName&&(e.round.roundName=t.round.roundName)),t.contributions&&(t.contributions.num&&(e.contributions.num=t.contributions.num),t.contributions.value&&(e.contributions.value=t.contributions.value),t.contributions.valueDue&&(e.contributions.valueDue=t.contributions.valueDue)),t.tracks&&(e.tracks=[],t.tracks.forEach(function(t){var u={track:{trackId:mongoose.Types.ObjectId(t.track.trackId),trackName:t.track.trackName},deviations:{additions:[],subtractions:[]}};t.deviations.additions&&t.deviations.additions.forEach(function(e){u.deviations.additions.push({product:{productId:mongoose.Types.ObjectId(e.product.productId),label:e.product.label},quantity:e.quantity,value:e.value})}),t.deviations.subtractions&&t.deviations.subtractions.forEach(function(e){u.deviations.subtractions.push({product:{productId:mongoose.Types.ObjectId(e.product.productId),label:e.product.label},quantity:e.quantity,value:e.value})}),e.tracks.push(u)})),t.cart&&(t.cart.num&&(e.cart.num=t.cart.num),t.cart.value&&(e.cart.value=t.cart.value)),t.deliveryFees&&(t.deliveryFees.valuePaid&&(e.deliveryFees.valuePaid=t.deliveryFees.valuePaid),t.deliveryFees.valueDue&&(e.deliveryFees.valueDue=t.deliveryFees.valueDue)),t.complete&&(e.complete=t.complete),u(e)})}function convertToAbstract(e,t){return void 0===t&&(t=!1),this.checkThrow(t).then(function(t){return new Promise(function(t,u){var r=[];e.forEach(function(e){var t={id:e._id.toHexString(),user:{userId:e.user.userId.toHexString(),emailAddress:e.user.emailAddress},round:{roundId:e.round.roundId.toHexString(),roundName:e.round.roundName},contributions:{num:e.contributions.num,value:e.contributions.value,valueDue:e.contributions.valueDue},tracks:[],cart:{num:e.cart.num,value:e.cart.value},deliveryFees:{valuePaid:e.deliveryFees.valuePaid,valueDue:e.deliveryFees.valueDue},complete:e.complete,createdAt:e.createdAt,updatedAt:e.updatedAt};e.tracks&&e.tracks.forEach(function(e){var u={track:{trackId:e.track.trackId.toHexString(),trackName:e.track.trackName},deviations:{additions:[],subtractions:[]}};e.deviations.additions&&e.deviations.additions.forEach(function(e){u.deviations.additions.push({product:{productId:e.product.productId.toHexString(),label:e.product.label},quantity:e.quantity,value:e.value})}),e.deviations.subtractions&&e.deviations.subtractions.forEach(function(e){u.deviations.subtractions.push({product:{productId:e.product.productId.toHexString(),label:e.product.label},quantity:e.quantity,value:e.value})}),t.tracks.push()}),r.push(t)}),t(r)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,t,u){var r=new generic_event_class_1.default(e,"GrocRound|RoundContributor");return new generic_model_class_1.default(r,model_1.MongooseModel,t,u,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};