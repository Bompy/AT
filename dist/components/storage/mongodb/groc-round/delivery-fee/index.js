"use strict";function makeConditions(e){return new Promise(function(r,n){var t={};e.user&&(e.user.userId&&(t["user.userId"]=mongoose.Types.ObjectId(e.user.userId)),e.user.emailAddress&&(t["user.emailAddress"]=e.user.emailAddress),e.user.fullName&&(t["user.fullName"]=e.user.fullName)),e.round&&(e.round.roundId&&(t["round.roundId"]=mongoose.Types.ObjectId(e.round.roundId)),e.round.roundName&&(t["round.roundName"]=e.round.roundName)),e.payment&&(e.payment.identifier&&(t["payment.identifier"]=e.payment.identifier),e.payment.amount&&(t["payment.amount"]={},e.payment.amount.min&&(t["payment.amount"].$gte=e.payment.amount.min),e.payment.amount.max&&(t["payment.amount"].$lte=e.payment.amount.max)),e.payment.method&&(t["payment.method"]=e.payment.method)),e.textSearch&&(t.$text={$search:e.textSearch}),r(t)})}function makeSortCriteria(e){return new Promise(function(r,n){var t;t=e.criteria,"amount"==e.criteria&&(t="payment.amount"),"Descending"===e.order&&(t="-"+t),r(t)})}function generateAddDetails(e){var r=[];return e.forEach(function(e){var n={user:{userId:mongoose.Types.ObjectId(e.user.userId),emailAddress:e.user.emailAddress},round:{roundId:mongoose.Types.ObjectId(e.round.roundId),roundName:e.round.roundName},payment:{identifier:e.payment.identifier,amount:e.payment.amount,method:e.payment.method}};e.user.fullName&&(n.user.fullName=e.user.fullName),r.push(n)}),r}function generateUpdateDetails(e,r){return new Promise(function(n,t){r.user&&(r.user.userId&&(e.user.userId=mongoose.Types.ObjectId(r.user.userId)),r.user.emailAddress&&(e.user.emailAddress=r.user.emailAddress),r.user.fullName&&(e.user.fullName=r.user.fullName)),r.round&&(r.round.roundId&&(e.round.roundId=mongoose.Types.ObjectId(r.round.roundId)),r.round.roundName&&(e.round.roundName=r.round.roundName)),r.payment&&(r.payment.identifier&&(e.payment.identifier=r.payment.identifier),r.payment.amount&&(e.payment.amount=r.payment.amount),r.payment.method&&(e.payment.method=r.payment.method)),n(e)})}function convertToAbstract(e,r){return void 0===r&&(r=!1),this.checkThrow(r).then(function(r){return new Promise(function(r,n){var t=[];e.forEach(function(e){var r={id:e._id.toHexString(),user:{userId:e.user.userId.toHexString(),emailAddress:e.user.emailAddress},round:{roundId:e.round.roundId.toHexString(),roundName:e.round.roundName},payment:{identifier:e.payment.identifier,amount:e.payment.amount,method:e.payment.method},createdAt:e.createdAt,updatedAt:e.updatedAt};e.user.fullName&&(r.user.fullName=e.user.fullName),t.push(r)}),r(t)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,r,n){var t=new generic_event_class_1.default(e,"GrocRound|DeliveryFee");return new generic_model_class_1.default(t,model_1.MongooseModel,r,n,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};