"use strict";function makeConditions(e){return new Promise(function(r,s){var u={};e.user&&(e.user.userId&&(u["user.userId"]=mongoose.Types.ObjectId(e.user.userId)),e.user.emailAddress&&(u["user.emailAddress"]=e.user.emailAddress),e.user.fullName&&(u["user.fullName"]=e.user.fullName)),e.app&&(u.app=e.app),e.textSearch&&(u.$text={$search:e.textSearch}),r(u)})}function makeSortCriteria(e){return new Promise(function(r,s){var u;u=e.criteria,"Descending"===e.order&&(u="-"+u),r(u)})}function generateAddDetails(e){var r=[];return e.forEach(function(e){var s={user:{userId:mongoose.Types.ObjectId(e.user.userId),emailAddress:e.user.emailAddress},app:e.app,invitees:[]};e.user.fullName&&(s.user.fullName=e.user.fullName),e.invitees.length&&e.invitees.forEach(function(e){var r={emailAddress:e.emailAddress,converted:e.converted};e.userId&&(r.userId=mongoose.Types.ObjectId(e.userId)),e.fullName&&(r.fullName=e.fullName),s.invitees.push(r)}),r.push(s)}),r}function generateUpdateDetails(e,r){return new Promise(function(s,u){r.user&&(r.user.userId&&(e.user.userId=mongoose.Types.ObjectId(r.user.userId)),r.user.emailAddress&&(e.user.emailAddress=r.user.emailAddress),r.user.fullName&&(e.user.fullName=r.user.fullName)),r.app&&(e.app=r.app),r.invitees&&(e.invitees=[],r.invitees.forEach(function(r){var s={emailAddress:r.emailAddress,converted:r.converted};r.userId&&(s.userId=mongoose.Types.ObjectId(r.userId)),r.fullName&&(s.fullName=r.fullName),e.invitees.push(s)})),s(e)})}function convertToAbstract(e,r){return void 0===r&&(r=!1),this.checkThrow(r).then(function(r){return new Promise(function(r,s){var u=[];e.forEach(function(e){var r={id:e._id.toHexString(),user:{userId:e.user.userId.toHexString(),emailAddress:e.user.emailAddress},app:e.app,invitees:[],createdAt:e.createdAt,updatedAt:e.updatedAt};e.user.fullName&&(r.user.fullName=e.user.fullName),e.invitees.length&&e.invitees.forEach(function(e){var s={emailAddress:e.emailAddress,converted:e.converted};e.userId&&(s.userId=e.userId.toHexString()),e.fullName&&(s.fullName=e.fullName),r.invitees.push(s)}),u.push(r)}),r(u)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,r,s){var u=new generic_event_class_1.default(e,"Core|Invitation");return new generic_model_class_1.default(u,model_1.MongooseModel,r,s,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};