"use strict";function makeConditions(e){return new Promise(function(i,t){var s={};e.emailAddress&&(s.emailAddress=e.emailAddress),e.accessLevel&&(s.accessLevel=e.accessLevel),e.verification&&(e.verification.verified&&(s["verification.verified"]=e.verification.verified),e.verification.numVerAttempts&&(s["verification.numVerAttempts"]={},e.verification.numVerAttempts.min&&(s["verification.numVerAttempts"].$gte=e.verification.numVerAttempts.min),e.verification.numVerAttempts.max&&(s["verification.numVerAttempts"].$lte=e.verification.numVerAttempts.max))),e.personalDetails&&(e.personalDetails.firstName&&(s["personalDetails.firstName"]=e.personalDetails.firstName),e.personalDetails.lastName&&(s["personalDetails.lastName"]=e.personalDetails.lastName),e.personalDetails.dateOfBirth&&(s["personalDetails.dateOfBirth"]={},e.personalDetails.dateOfBirth.min&&(s["personalDetails.dateOfBirth"].$gte=e.personalDetails.dateOfBirth.min),e.personalDetails.dateOfBirth.max&&(s["personalDetails.dateOfBirth"].$lte=e.personalDetails.dateOfBirth.max)),e.personalDetails.gender&&(s["personalDetails.gender"]=e.personalDetails.gender)),e.contactDetails&&e.contactDetails.phoneNumbers&&(s["contactDetails.phoneNumbers"]={$all:e.contactDetails.phoneNumbers}),e.activeApps&&(s.activeApps={$all:e.activeApps}),e.subscriptions&&(s.subscriptions={$all:e.subscriptions}),e.residentialDetails&&(e.residentialDetails.country&&(s["residentialDetails.country"]=e.residentialDetails.country),e.residentialDetails.province&&(s["residentialDetails.province"]=e.residentialDetails.province),e.residentialDetails.address&&(s["residentialDetails.address"]=e.residentialDetails.address)),e.textSearch&&(s.$text={$search:e.textSearch}),i(s)})}function makeSortCriteria(e){return new Promise(function(i,t){var s;s="numVerAttempts"===e.criteria?"verification.numVerAttempts":e.criteria,"Descending"===e.order&&(s="-"+s),i(s)})}function generateAddDetails(e){var i=[];return e.forEach(function(e){var t={emailAddress:e.emailAddress,password:e.password,accessLevel:e.accessLevel,verification:{verified:e.verification.verified,numVerAttempts:e.verification.numVerAttempts},subscriptions:e.subscriptions,activeApps:[]};e.resetCode&&(t.resetCode=e.resetCode),e.verification.verificationCode&&(t.verification.verificationCode=e.verification.verificationCode),e.personalDetails&&(t.personalDetails={firstName:e.personalDetails.firstName,lastName:e.personalDetails.lastName,dateOfBirth:e.personalDetails.dateOfBirth,gender:e.personalDetails.gender}),e.contactDetails&&(t.contactDetails={phoneNumbers:e.contactDetails.phoneNumbers}),e.residentialDetails&&(t.residentialDetails={country:e.residentialDetails.country,province:e.residentialDetails.province,address:e.residentialDetails.address}),i.push(t)}),i}function generateUpdateDetails(e,i){return new Promise(function(t,s){i.emailAddress&&(e.emailAddress=i.emailAddress),i.accessLevel&&(e.accessLevel=i.accessLevel),i.password&&(e.password=i.password),i.resetCode&&(e.resetCode=i.resetCode),i.verification&&(i.verification.verified&&(e.verification.verified=i.verification.verified),i.verification.verificationCode&&(e.verification.verificationCode=i.verification.verificationCode),i.verification.numVerAttemptsMinus&&(e.verification.numVerAttempts-=i.verification.numVerAttemptsMinus),i.verification.numVerAttemptsPlus&&(e.verification.numVerAttempts+=i.verification.numVerAttemptsPlus),i.verification.numVerAttempts&&(e.verification.numVerAttempts=i.verification.numVerAttempts)),i.personalDetails&&(e.personalDetails||(e.personalDetails={firstName:"",lastName:"",dateOfBirth:null,gender:"Male"}),i.personalDetails.firstName&&(e.personalDetails.firstName=i.personalDetails.firstName),i.personalDetails.lastName&&(e.personalDetails.lastName=i.personalDetails.lastName),i.personalDetails.dateOfBirth&&(e.personalDetails.dateOfBirth=i.personalDetails.dateOfBirth),i.personalDetails.gender&&(e.personalDetails.gender=i.personalDetails.gender)),i.contactDetails&&(e.contactDetails||(e.contactDetails={phoneNumbers:[]}),i.contactDetails.phoneNumbers&&(e.contactDetails.phoneNumbers=[],i.contactDetails.phoneNumbers.forEach(function(i){e.contactDetails.phoneNumbers.push(i)}))),i.residentialDetails&&(e.residentialDetails||(e.residentialDetails={country:"",province:"",address:""}),i.residentialDetails.country&&(e.residentialDetails.country=i.residentialDetails.country),i.residentialDetails.province&&(e.residentialDetails.province=i.residentialDetails.province),i.residentialDetails.address&&(e.residentialDetails.address=i.residentialDetails.address)),i.subscriptionsToAdd&&(e.subscriptions||(e.subscriptions=[]),i.subscriptionsToAdd.forEach(function(i){e.subscriptions.push(i)})),i.subscriptionsToRemove&&(e.subscriptions||(e.subscriptions=[]),i.subscriptionsToRemove.forEach(function(i){var t=e.subscriptions.filter(function(e){return e==i});t.length&&e.subscriptions.splice(e.subscriptions.indexOf(t[0]),1)})),i.subscriptions&&(e.subscriptions=i.subscriptions),i.activeAppsToAdd&&(e.activeApps||(e.activeApps=[]),i.activeAppsToAdd.forEach(function(i){e.activeApps.push(i)})),i.activeAppsToRemove&&(e.activeApps||(e.activeApps=[]),i.activeAppsToRemove.forEach(function(i){var t=e.activeApps.filter(function(e){return e==i});t.length&&e.activeApps.splice(e.activeApps.indexOf(t[0]),1)})),t(e)})}function convertToAbstract(e,i){return void 0===i&&(i=!1),this.checkThrow(i).then(function(i){return new Promise(function(i,t){var s=[];e.forEach(function(e){var i={id:e._id.toHexString(),emailAddress:e.emailAddress,accessLevel:e.accessLevel,password:e.password,verification:{verified:e.verification.verified,numVerAttempts:e.verification.numVerAttempts},subscriptions:e.subscriptions,activeApps:e.activeApps,createdAt:e.createdAt,updatedAt:e.updatedAt};e.resetCode&&(i.resetCode=e.resetCode),e.verification.verificationCode&&(i.verification.verificationCode=e.verification.verificationCode),e.personalDetails&&(i.personalDetails={firstName:e.personalDetails.firstName,lastName:e.personalDetails.lastName,dateOfBirth:e.personalDetails.dateOfBirth,gender:e.personalDetails.gender}),e.contactDetails&&(i.contactDetails={phoneNumbers:e.contactDetails.phoneNumbers}),e.residentialDetails&&(i.residentialDetails={country:e.residentialDetails.country,province:e.residentialDetails.province,address:e.residentialDetails.address}),s.push(i)}),i(s)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,i,t){var s=new generic_event_class_1.default(e,"Core|User");return new generic_model_class_1.default(s,model_1.MongooseModel,i,t,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};