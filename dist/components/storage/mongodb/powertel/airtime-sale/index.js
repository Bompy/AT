"use strict";function makeConditions(e){return new Promise(function(d,r){var s={};e.buyerName&&(s.buyerName=e.buyerName),e.card&&(e.card.cardId&&(s["card.cardId"]=mongoose.Types.ObjectId(e.card.cardId)),e.card.mdn&&(s["card.mdn"]={},e.card.mdn.min&&(s["card.mdn"].$gte=e.card.mdn.min),e.card.mdn.max&&(s["card.mdn"].$lte=e.card.mdn.max))),e.user&&(e.user.userId&&(s["user.userId"]=mongoose.Types.ObjectId(e.user.userId)),e.user.emailAddress&&(s["user.emailAddress"]=e.user.emailAddress),e.user.fullName&&(s["user.fullName"]=e.user.fullName)),e.bundles&&(e.bundles.gb&&(s["bundles.gb"]={},e.bundles.gb.min&&(s["bundles.gb"].$gte=e.bundles.gb.min),e.bundles.gb.max&&(s["bundles.gb"].$lte=e.bundles.gb.max)),e.bundles.days&&(s["bundles.days"]={},e.bundles.days.min&&(s["bundles.days"].$gte=e.bundles.days.min),e.bundles.days.max&&(s["bundles.days"].$lte=e.bundles.days.max))),e.textSearch&&(s.$text={$search:e.textSearch}),d(s)})}function makeSortCriteria(e){return new Promise(function(d,r){var s;s="mdn"===e.criteria?"card.mdn":"gb"===e.criteria?"bundles.gb":"days"===e.criteria?"bundles.days":e.criteria,"Descending"===e.order&&(s="-"+s),d(s)})}function generateAddDetails(e){var d=[];return e.forEach(function(e){var r={buyerName:e.buyerName,amount:e.amount};e.card&&(r.card={cardId:mongoose.Types.ObjectId(e.card.cardId),mdn:e.card.mdn}),e.user&&(r.user={userId:mongoose.Types.ObjectId(e.user.userId),emailAddress:e.user.emailAddress,fullName:e.user.fullName}),e.bundles&&(r.bundles={gb:e.bundles.gb,days:e.bundles.days}),d.push(r)}),d}function generateUpdateDetails(e,d){return new Promise(function(r,s){d.buyerName&&(e.buyerName=d.buyerName),d.card&&(d.card.cardId&&(e.card.cardId=mongoose.Types.ObjectId(d.card.cardId)),d.card.mdn&&(e.card.mdn=d.card.mdn)),d.user&&(d.user.userId&&(e.user.userId=mongoose.Types.ObjectId(d.user.userId)),d.user.emailAddress&&(e.user.emailAddress=d.user.emailAddress),d.user.fullName&&(e.user.fullName=d.user.fullName)),d.bundles&&(d.bundles.gb&&(e.bundles.gb=d.bundles.gb),d.bundles.days&&(e.bundles.days=d.bundles.days)),r(e)})}function convertToAbstract(e,d){return void 0===d&&(d=!1),this.checkThrow(d).then(function(d){return new Promise(function(d,r){var s=[];e.forEach(function(e){var d={id:e._id.toHexString(),buyerName:e.buyerName,amount:e.amount,createdAt:e.createdAt,updatedAt:e.updatedAt};e.card&&(d.card={cardId:e.card.cardId.toHexString(),mdn:e.card.mdn}),e.user&&(d.user={userId:e.user.userId.toHexString(),emailAddress:e.user.emailAddress,fullName:e.user.fullName}),e.bundles&&(d.bundles={gb:e.bundles.gb,days:e.bundles.days}),s.push(d)}),d(s)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,d,r){var s=new generic_event_class_1.default(e,"Powertel|AirtimeSale");return new generic_model_class_1.default(s,model_1.MongooseModel,d,r,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};