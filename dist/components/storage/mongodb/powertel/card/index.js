"use strict";function makeConditions(e){return new Promise(function(r,u){var s={};e.pin&&(s.pin=e.pin),e.puk&&(s.puk=e.puk),e.mdn&&(s.mdn=e.mdn),e.buyer&&(e.buyer.cardSaleId&&(s["buyer.cardSaleId"]=mongoose.Types.ObjectId(e.buyer.cardSaleId)),e.buyer.fullName&&(s["buyer.fullName"]=e.buyer.fullName)),e.user&&(e.user.userId&&(s["user.userId"]=mongoose.Types.ObjectId(e.user.userId)),e.user.emailAddress&&(s["user.emailAddress"]=e.user.emailAddress),e.user.fullName&&(s["user.fullName"]=e.user.fullName)),e.textSearch&&(s.$text={$search:e.textSearch}),r(s)})}function makeSortCriteria(e){return new Promise(function(r,u){var s;s=e.criteria,"Descending"===e.order&&(s="-"+s),r(s)})}function generateAddDetails(e){var r=[];return e.forEach(function(e){var u={pin:e.pin,puk:e.puk,mdn:e.mdn};e.buyer&&(u.buyer={cardSaleId:mongoose.Types.ObjectId(e.buyer.cardSaleId),fullName:e.buyer.fullName}),e.user&&(u.user={userId:mongoose.Types.ObjectId(e.user.userId),emailAddress:e.user.emailAddress,fullName:e.user.fullName}),r.push(u)}),r}function generateUpdateDetails(e,r){return new Promise(function(u,s){r.pin&&(e.pin=r.pin),r.puk&&(e.puk=r.puk),r.mdn&&(e.mdn=r.mdn),r.buyer&&(r.buyer.cardSaleId&&(e.buyer.cardSaleId=mongoose.Types.ObjectId(r.buyer.cardSaleId)),r.buyer.fullName&&(e.buyer.fullName=r.buyer.fullName)),r.user&&(r.user.userId&&(e.user.userId=mongoose.Types.ObjectId(r.user.userId)),r.user.emailAddress&&(e.user.emailAddress=r.user.emailAddress),r.user.fullName&&(e.user.fullName=r.user.fullName)),u(e)})}function convertToAbstract(e,r){return void 0===r&&(r=!1),this.checkThrow(r).then(function(r){return new Promise(function(r,u){var s=[];e.forEach(function(e){var r={id:e._id.toHexString(),pin:e.pin,puk:e.puk,mdn:e.mdn,createdAt:e.createdAt,updatedAt:e.updatedAt};e.buyer&&(r.buyer={cardSaleId:e.buyer.cardSaleId.toHexString(),fullName:e.buyer.fullName}),e.user&&(r.user={userId:e.user.userId.toHexString(),emailAddress:e.user.emailAddress,fullName:e.user.fullName}),s.push(r)}),r(s)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,r,u){var s=new generic_event_class_1.default(e,"Powertel|Card");return new generic_model_class_1.default(s,model_1.MongooseModel,r,u,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};