"use strict";function makeConditions(e){return new Promise(function(t,r){var a={};e.buyer&&(e.buyer.fullName&&(a["buyer.fullName"]=e.buyer.fullName),e.buyer.emailAddress&&(a["buyer.emailAddress"]=e.buyer.emailAddress),e.buyer.phoneNumber&&(a["buyer.phoneNumber"]=e.buyer.phoneNumber)),e.simCard&&(e.simCard.cardId&&(a["simCard.cardId"]=mongoose.Types.ObjectId(e.simCard.cardId)),e.simCard.mdn&&(a["simCard.mdn"]=e.simCard.mdn)),e.type&&(a.type=e.type),e.paymentMethod&&(a.paymentMethod=e.paymentMethod),e.unitCost&&(a.unitCost={},e.unitCost.min&&(a.unitCost.$gte=e.unitCost.min),e.unitCost.max&&(a.unitCost.$lte=e.unitCost.max)),e.amount&&(a.amount={},e.amount.min&&(a.amount.$gte=e.amount.min),e.amount.max&&(a.amount.$lte=e.amount.max)),e.totalCost&&(a.totalCost={},e.totalCost.min&&(a.totalCost.$gte=e.totalCost.min),e.totalCost.max&&(a.totalCost.$lte=e.totalCost.max)),e.textSearch&&(a.$text={$search:e.textSearch}),t(a)})}function makeSortCriteria(e){return new Promise(function(t,r){var a;a=e.criteria,"Descending"===e.order&&(a="-"+a),t(a)})}function generateAddDetails(e){var t=[];return e.forEach(function(e){var r={buyer:{fullName:e.buyer.fullName,emailAddress:e.buyer.emailAddress,phoneNumber:e.buyer.phoneNumber},type:e.type,paymentMethod:e.paymentMethod,unitCost:e.unitCost,amount:e.amount,totalCost:e.totalCost};e.simCard&&(r.simCard={cardId:mongoose.Types.ObjectId(e.simCard.cardId),mdn:e.simCard.mdn}),t.push(r)}),t}function generateUpdateDetails(e,t){return new Promise(function(r,a){t.buyer&&(t.buyer.fullName&&(e.buyer.fullName=t.buyer.fullName),t.buyer.emailAddress&&(e.buyer.emailAddress=t.buyer.emailAddress),t.buyer.phoneNumber&&(e.buyer.phoneNumber=t.buyer.phoneNumber)),t.simCard&&(t.simCard.cardId&&(e.simCard.cardId=mongoose.Types.ObjectId(t.simCard.cardId)),t.simCard.mdn&&(e.simCard.mdn=t.simCard.mdn)),t.type&&(e.type=t.type),t.paymentMethod&&(e.paymentMethod=t.paymentMethod),t.unitCost&&(e.unitCost=t.unitCost),t.amount&&(e.amount=t.amount),t.totalCost&&(e.totalCost=t.totalCost),r(e)})}function convertToAbstract(e,t){return void 0===t&&(t=!1),this.checkThrow(t).then(function(t){return new Promise(function(t,r){var a=[];e.forEach(function(e){var t={id:e._id.toHexString(),buyer:{fullName:e.buyer.fullName,emailAddress:e.buyer.emailAddress,phoneNumber:e.buyer.phoneNumber},type:e.type,paymentMethod:e.paymentMethod,unitCost:e.unitCost,amount:e.amount,totalCost:e.totalCost,createdAt:e.createdAt,updatedAt:e.updatedAt};e.simCard&&(t.simCard={cardId:e.simCard.cardId.toHexString(),mdn:e.simCard.mdn}),a.push(t)}),t(a)})})}Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),mongoose=require("mongoose"),generic_model_class_1=require("../../generic-model-class"),generic_event_class_1=require("../../generic-event-class"),model_1=require("./model");exports.default=function(e,t,r){var a=new generic_event_class_1.default(e,"Routers|Sale");return new generic_model_class_1.default(a,model_1.MongooseModel,t,r,makeConditions,makeSortCriteria,generateAddDetails,generateUpdateDetails,convertToAbstract)};