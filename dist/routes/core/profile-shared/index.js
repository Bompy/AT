"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),ProfileShared=function(){return function(e,n,s,t,i,r,o,d,a,l,u){var p=this;this.getUserDetails=e,this.updateUserDetails=n,this.changeUserEmailAddress=s,this.changeUserPassword=t,this.requestUserPasswordResetCode=i,this.resetUserPassword=r,this.deleteUserAccount=o,this.generateRandomNumber=d,this.signedIn=a,this.getUserId=l,this.sendResponse=u,this.getDetails=function(e){return function(n,s,t){return p.signedIn(n)?p.getUserDetails(p.getUserId(n)).then(function(n){return p.sendResponse(s,e,!0,null,{foundUser:n,innerContext:"profile"})}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:"profile"}):p.sendResponse(s,e,!1,null,{innerContext:"profile"})}):p.sendResponse(s,"passpoint",!1,null,{innerContext:"profile"})}},this.updateDetails=function(e){return function(n,s,t){if(!p.signedIn(n))return p.sendResponse(s,"passpoint",!1,null,{innerContext:"edit-profile"});var i={};return n.body.personalDetails&&(i.personalDetails={},n.body.personalDetails.firstName&&(i.personalDetails.firstName=n.body.personalDetails.firstName),n.body.personalDetails.lastName&&(i.personalDetails.lastName=n.body.personalDetails.lastName),n.body.personalDetails.dateOfBirth&&(i.personalDetails.dateOfBirth=n.body.personalDetails.dateOfBirth),n.body.personalDetails.gender&&(i.personalDetails.gender=n.body.personalDetails.gender)),n.body.contactDetails&&(i.contactDetails={},n.body.contactDetails.phoneNumbers&&(i.contactDetails.phoneNumbers=n.body.contactDetails.phoneNumbers)),n.body.residentialDetails&&(i.residentialDetails={},n.body.residentialDetails.country&&(i.residentialDetails.country=n.body.residentialDetails.country),n.body.residentialDetails.province&&(i.residentialDetails.province=n.body.residentialDetails.province),n.body.residentialDetails.address&&(i.residentialDetails.address=n.body.residentialDetails.address)),i?p.updateUserDetails(p.getUserId(n),i).then(function(n){return p.sendResponse(s,e,!0,null,{updatedUser:n,innerContext:"edit-profile"})}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:"edit-profile"}):p.sendResponse(s,e,!1,null,{innerContext:"edit-profile"})}):p.sendResponse(s,e,!1,"",{innerContext:"edit-profile"})}},this.changeEmailAddress=function(e){return function(n,s,t){var i="change-email-address";return p.signedIn(n)?n.body.password?n.body.newEmailAddress?p.changeUserEmailAddress(p.getUserId(n),n.body.password,n.body.newEmailAddress,n).then(function(e){return p.sendResponse(s,"passpoint",!0,"A verification email has been sent to your email address",{innerContext:i})}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:i}):p.sendResponse(s,e,!1,null,{innerContext:i})}):p.sendResponse(s,e,!1,"The new email address is missing",{innerContext:i}):p.sendResponse(s,e,!1,"Password is missing",{innerContext:i}):p.sendResponse(s,"passpoint",!1,null,{innerContext:i})}},this.changePassword=function(e){return function(n,s,t){return p.signedIn(n)?n.body.oldPassword?n.body.newPassword?p.changeUserPassword(p.getUserId(n),n.body.oldPassword,n.body.newPassword).then(function(n){return p.sendResponse(s,e,!0,null,{innerContext:"profile"})}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:"profile"}):n.identifier&&"InvalidPassword"==n.identifier?p.sendResponse(s,e,!1,"InvalidPassword",{innerContext:"profile"}):p.sendResponse(s,e,!1,null,{innerContext:"profile"})}):p.sendResponse(s,e,!1,"The new password is missing",{innerContext:"profile"}):p.sendResponse(s,e,!1,"Password is missing",{innerContext:"profile"}):p.sendResponse(s,"passpoint",!1,null,{innerContext:"profile"})}},this.requestPasswordResetCode=function(){return function(e,n,s){var t="request-reset-code";return p.signedIn(e)?e.params.emailAddress?p.requestUserPasswordResetCode(e.params.emailAddress).then(function(e){return p.sendResponse(n,"passpoint",!0,"The reset code has been sent to your email address",{innerContext:t})}).catch(function(e){return e.identifier&&"UserNotFound"==e.identifier?p.sendResponse(n,"passpoint",!1,"User not found",{innerContext:t}):p.sendResponse(n,"passpoint",!1,null,{innerContext:t})}):p.sendResponse(n,"passpoint",!1,"Email address is missing",{innerContext:t}):p.sendResponse(n,"passpoint",!1,null,{innerContext:t})}},this.resetPassword=function(){return function(e,n,s){return p.signedIn(e)?Promise.all([p.generateRandomNumber(8765,9172),p.generateRandomNumber(8132,8793)]).then(function(n){return p.resetUserPassword(p.getUserId(e),e.query.resetCode,String(n[0])+String(n[1]))}).then(function(e){return p.sendResponse(n,"passpoint",!0,"Your password has been reset",{innerContext:"reset-password",newRandomPassword:e})}).catch(function(e){return e.identifier&&"UserNotFound"==e.identifier?p.sendResponse(n,"passpoint",!1,"User not found",{innerContext:"reset-password"}):e.identifier&&"InvalidResetCode"==e.identifier?p.sendResponse(n,"passpoint",!1,"InvalidResetCode",{innerContext:"reset-password"}):p.sendResponse(n,"passpoint",!1,null,{innerContext:"reset-password"})}):p.sendResponse(n,"passpoint",!1,null,{innerContext:"reset-password"})}},this.deleteAccount=function(e){return function(n,s,t){return p.signedIn(n)?p.deleteUserAccount(p.getUserId(n),n.body.password).then(function(e){return p.sendResponse(s,"passpoint",!0,"Account deleted",null)}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:"delete-account"}):n.identifier&&"InvalidResetCode"==n.identifier?p.sendResponse(s,e,!1,"InvalidResetCode",{innerContext:"delete-account"}):p.sendResponse(s,e,!1,null,{innerContext:"delete-account"})}):p.sendResponse(s,"passpoint",!1,null,{innerContext:"delete-account"})}}}}();exports.default=ProfileShared;