"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Promise=require("bluebird"),ProfileShared=function(){return function(e,n,s,t,r,i,o,d,a,l,u){var p=this;this.getUserDetails=e,this.updateUserDetails=n,this.changeUserEmailAddress=s,this.changeUserPassword=t,this.requestUserPasswordResetCode=r,this.resetUserPassword=i,this.deleteUserAccount=o,this.generateRandomNumber=d,this.signedIn=a,this.getUserId=l,this.sendResponse=u,this.getDetails=function(e){return function(n,s,t){return p.signedIn(n)?p.getUserDetails(p.getUserId(n)).then(function(n){return p.sendResponse(s,e,!0,null,{foundUser:n,innerContext:"profile"})}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:"profile"}):p.sendResponse(s,e,!1,null,{innerContext:"profile"})}):p.sendResponse(s,"passpoint",!1,null,{innerContext:"profile"})}},this.updateDetails=function(e){return function(n,s,t){if(!p.signedIn(n))return p.sendResponse(s,"passpoint",!1,null,{innerContext:"edit-profile"});var r={};return n.body.personalDetails&&(r.personalDetails={},n.body.personalDetails.firstName&&(r.personalDetails.firstName=n.body.personalDetails.firstName),n.body.personalDetails.lastName&&(r.personalDetails.lastName=n.body.personalDetails.lastName),n.body.personalDetails.dateOfBirth&&(r.personalDetails.dateOfBirth=n.body.personalDetails.dateOfBirth),n.body.personalDetails.gender&&(r.personalDetails.gender=n.body.personalDetails.gender)),n.body.contactDetails&&(r.contactDetails={},n.body.contactDetails.phoneNumbers&&(r.contactDetails.phoneNumbers=n.body.contactDetails.phoneNumbers)),n.body.residentialDetails&&(r.residentialDetails={},n.body.residentialDetails.country&&(r.residentialDetails.country=n.body.residentialDetails.country),n.body.residentialDetails.province&&(r.residentialDetails.province=n.body.residentialDetails.province),n.body.residentialDetails.address&&(r.residentialDetails.address=n.body.residentialDetails.address)),r?p.updateUserDetails(p.getUserId(n),r).then(function(n){return p.sendResponse(s,e,!0,null,{updatedUser:n,innerContext:"edit-profile"})}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:"edit-profile"}):p.sendResponse(s,e,!1,null,{innerContext:"edit-profile"})}):p.sendResponse(s,e,!1,"",{innerContext:"edit-profile"})}},this.changeEmailAddress=function(e){return function(n,s,t){var r="change-email-address";return p.signedIn(n)?n.body.password?n.body.newEmailAddress?p.changeUserEmailAddress(p.getUserId(n),n.body.password,n.body.newEmailAddress,n).then(function(e){return p.sendResponse(s,"passpoint",!0,"A verification email has been sent to your email address",{innerContext:r})}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:r}):p.sendResponse(s,e,!1,null,{innerContext:r})}):p.sendResponse(s,e,!1,"The new email address is missing",{innerContext:r}):p.sendResponse(s,e,!1,"Password is missing",{innerContext:r}):p.sendResponse(s,"passpoint",!1,null,{innerContext:r})}},this.changePassword=function(e){return function(n,s,t){return p.signedIn(n)?n.body.oldPassword?n.body.newPassword?p.changeUserPassword(p.getUserId(n),n.body.oldPassword,n.body.newPassword).then(function(n){return p.sendResponse(s,e,!0,null,{innerContext:"profile"})}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:"profile"}):n.identifier&&"InvalidPassword"==n.identifier?p.sendResponse(s,e,!1,"InvalidPassword",{innerContext:"profile"}):p.sendResponse(s,e,!1,null,{innerContext:"profile"})}):p.sendResponse(s,e,!1,"The new password is missing",{innerContext:"profile"}):p.sendResponse(s,e,!1,"Password is missing",{innerContext:"profile"}):p.sendResponse(s,"passpoint",!1,null,{innerContext:"profile"})}},this.requestPasswordResetCode=function(){return function(e,n,s){return e.params.emailAddress?p.requestUserPasswordResetCode(e.params.emailAddress).then(function(e){return p.sendResponse(n,"passpoint",!0,"The reset code has been sent to your email address",{innerContext:"request-reset-code"})}).catch(function(e){return e.identifier&&"UserNotFound"==e.identifier?p.sendResponse(n,"passpoint",!1,"User not found",{innerContext:"request-reset-code"}):p.sendResponse(n,"passpoint",!1,null,{innerContext:"request-reset-code"})}):p.sendResponse(n,"passpoint",!1,"Email address is missing",{innerContext:"request-reset-code"})}},this.resetPassword=function(){return function(e,n,s){return p.signedIn(e)?Promise.all([p.generateRandomNumber(8765,9172),p.generateRandomNumber(8132,8793)]).then(function(n){return p.resetUserPassword(p.getUserId(e),e.query.resetCode,String(n[0])+String(n[1]))}).then(function(e){return p.sendResponse(n,"passpoint",!0,"Your password has been reset",{innerContext:"reset-password",newRandomPassword:e})}).catch(function(e){return e.identifier&&"UserNotFound"==e.identifier?p.sendResponse(n,"passpoint",!1,"User not found",{innerContext:"reset-password"}):e.identifier&&"InvalidResetCode"==e.identifier?p.sendResponse(n,"passpoint",!1,"InvalidResetCode",{innerContext:"reset-password"}):p.sendResponse(n,"passpoint",!1,null,{innerContext:"reset-password"})}):p.sendResponse(n,"passpoint",!1,null,{innerContext:"reset-password"})}},this.deleteAccount=function(e){return function(n,s,t){return p.signedIn(n)?p.deleteUserAccount(p.getUserId(n),n.body.password).then(function(e){return p.sendResponse(s,"passpoint",!0,"Account deleted",null)}).catch(function(n){return n.identifier&&"UserNotFound"==n.identifier?p.sendResponse(s,e,!1,"User not found",{innerContext:"delete-account"}):n.identifier&&"InvalidResetCode"==n.identifier?p.sendResponse(s,e,!1,"InvalidResetCode",{innerContext:"delete-account"}):p.sendResponse(s,e,!1,null,{innerContext:"delete-account"})}):p.sendResponse(s,"passpoint",!1,null,{innerContext:"delete-account"})}}}}();exports.default=ProfileShared;