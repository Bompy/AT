"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var express=require("express"),coreValidationAdd=require("../../../core/validation-add"),validationAdd=require("../../validation-add"),blocks=require("../../../validation/validation-blocks");exports.default=function(n,o,r,t,u,e){function d(n){return!!blocks.optionalWrong(n.body,"complete","boolean")}function i(n){return!!coreValidationAdd.user(n)||!!validationAdd.round(n)}var a=express.Router();return a.get("/getRoundContributors",function(o,r,t){var u={};return o.query.userId&&(u.user={userId:o.query.userId}),o.query.roundId&&(u.round={roundId:o.query.roundId}),n(u,null,null).then(function(n){return e(r,"grocRound-admin",!0,null,{foundRoundContributors:n,innerContext:"get-roundContributors"})}).catch(function(n){return e(r,"grocRound-admin",!1,null,{innerContext:"get-roundContributors"})})}),a.get("/getRoundContributor/:roundContributorId",function(n,r,t){var u="get-roundContributor";return n.params.roundContributorId?o(n.params.roundContributorId).then(function(n){return e(r,"grocRound-admin",!0,null,{foundRoundContributor:n,innerContext:u})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?e(r,"grocRound-admin",!1,"Couldn't find roundContributor",{innerContext:u}):e(r,"grocRound-admin",!1,null,{innerContext:u})}):e(r,"grocRound-admin",!1,"RoundContributor ID is missing",{innerContext:u})}),a.post("/addRoundContributor",function(n,o,t){if(i(n))return e(o,"grocRound-admin",!1,"Something is wrong with the data you sent",{innerContext:"add-roundContributor"});var u={round:n.body.round,user:n.body.user,contributions:{num:0,value:0,valueDue:0},tracks:[],cart:{num:0,value:0},deliveryFees:{valuePaid:0,valueDue:0},complete:!1};return r(u).then(function(n){return e(o,"grocRound-admin",!0,null,{addedRoundContributor:n,innerContext:"add-roundContributor"})}).catch(function(n){return e(o,"grocRound-admin",!1,null,{innerContext:"add-roundContributor"})})}),a.post("/updateRoundContributor/:roundContributorId",function(n,o,r){var u="update-roundContributor";if(!n.params.roundContributorId)return e(o,"grocRound-admin",!1,"Update id is missing",{innerContext:u});if(d(n))return e(o,"grocRound-admin",!1,"Something is wrong with the data you sent",{innerContext:u});var i={};return n.body.complete&&(i.complete=n.body.complete),t(n.params.roundContributorId,i).then(function(n){return e(o,"grocRound-admin",!0,null,{updatedRoundContributor:n,innerContext:u})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?e(o,"grocRound-admin",!1,"Couldn't find roundContributor",{innerContext:u}):e(o,"grocRound-admin",!1,null,{innerContext:u})})}),a.get("/deleteRoundContributor/:roundContributorId",function(n,o,r){var t="delete-roundContributor";return n.params.roundContributorId?u(n.params.roundContributorId).then(function(n){return e(o,"grocRound-admin",!0,null,{innerContext:t})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?e(o,"grocRound-admin",!1,"Couldn't find roundContributor",{innerContext:t}):e(o,"grocRound-admin",!1,null,{innerContext:t})}):e(o,"grocRound-admin",!1,"RoundContributor ID is missing",{innerContext:t})}),a};