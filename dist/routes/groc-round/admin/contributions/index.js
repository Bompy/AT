"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var express=require("express"),coreValidationAdd=require("../../../core/validation-add"),validationAdd=require("../../validation-add"),validationUpdate=require("../../validation-update");exports.default=function(n,t,o,i,e,r){function u(n){return!!validationUpdate.round(n)||(!(!n.body.payment||"object"==typeof n.body.payment)||(!(!n.body.payment.identifier||"string"==typeof n.body.payment.identifier)||(!(!n.body.payment.amount||"number"==typeof n.body.payment.amount)||!(!n.body.payment.method||"string"==typeof n.body.payment.method))))}function d(n){return!!coreValidationAdd.user(n)||(!!validationAdd.round(n)||(!n.body.payment||"object"!=typeof n.body.payment||(!n.body.payment.identifier||"string"!=typeof n.body.payment.identifier||(!n.body.payment.amount||"number"!=typeof n.body.payment.amount||!(!n.body.payment.method||"string"==typeof n.body.payment.method)))))}var a=express.Router();return a.get("/getContributions",function(t,o,i){var e={};return t.query.userId&&(e.user={userId:t.query.userId}),t.query.roundId&&(e.round={roundId:t.query.roundId}),n(e,null,null).then(function(n){return r(o,"grocRound-admin",!0,null,{foundContributions:n,innerContext:"get-contributions"})}).catch(function(n){return r(o,"grocRound-admin",!1,null,{innerContext:"get-contributions"})})}),a.get("/getContribution/:contributionId",function(n,o,i){return n.params.contributionId?t(n.params.contributionId).then(function(n){return r(o,"grocRound-admin",!0,null,{foundContribution:n,innerContext:"get-contribution"})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?r(o,"grocRound-admin",!1,"Couldn't find contribution",{innerContext:"get-contribution"}):r(o,"grocRound-admin",!1,null,{innerContext:"get-contribution"})}):r(o,"grocRound-admin",!1,"Contribution ID is missing",{innerContext:"get-contribution"})}),a.post("/addContribution",function(n,t,i){if(d(n))return r(t,"grocRound-admin",!1,"Something wrong with the data you sent",{innerContext:"add-contribution"});var e={user:n.body.user,round:n.body.round,payment:n.body.payment};return o(e).then(function(n){return r(t,"grocRound-admin",!0,null,{addedContribution:n,innerContext:"add-contribution"})}).catch(function(n){return r(t,"grocRound-admin",!1,null,{innerContext:"add-contribution"})})}),a.post("/updateContribution/:contributionId",function(n,t,o){var e="update-contribution";if(!n.params.contributionId)return r(t,"grocRound-admin",!1,"Contribution ID is missing",{innerContext:e});if(u(n))return r(t,"grocRound-admin",!1,"Something is wrong with the data you sent",{innerContext:e});var d={};return n.body.round&&(d.round=n.body.round),n.body.payment&&(d.payment=n.body.payment),i(n.params.contributionId,d).then(function(n){return r(t,"grocRound-admin",!0,null,{updatedContribution:n,innerContext:e})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?r(t,"grocRound-admin",!1,"Couldn't find contribution",{innerContext:e}):r(t,"grocRound-admin",!1,null,{innerContext:e})})}),a.get("/deleteContribution/:contributionId",function(n,t,o){var i="delete-contribution";return n.params.contributionId?e(n.params.contributionId).then(function(n){return r(t,"grocRound-admin",!0,null,{innerContext:i})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?r(t,"grocRound-admin",!1,"Couldn't find contribution",{innerContext:i}):r(t,"grocRound-admin",!1,null,{innerContext:i})}):r(t,"grocRound-admin",!1,"Contribution ID is missing",{innerContext:i})}),a};