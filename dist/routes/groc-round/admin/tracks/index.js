"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var express=require("express"),blocks=require("../../../validation/validation-blocks"),v=require("../../../validation/validation-revised");exports.default=function(n,t,e,r,o,a){function i(n){if(blocks.optionalWrong(n.body,"trackName","string"))return!0;var t="contributions";return!!blocks.optionalWrong(n.body,t,"object")||(!!blocks.optionalWrong(n.body[t],"installmentValue","number")||(!!blocks.optionalWrong(n.body[t],"totalValue","number")||!!blocks.optionalWrong(n.body,"adminFeePercentage","number")))}function d(n){if(console.log(n.body),v.round.absent(n.body))return!0;if(blocks.absentWrong(n.body,"trackName","string"))return!0;var t="contributions";return!!blocks.absentWrong(n.body,t,"object")||(!!blocks.absentWrong(n.body[t],"installmentValue","number")||(!!blocks.absentWrong(n.body[t],"totalValue","number")||!!blocks.absentWrong(n.body,"adminFeePercentage","number")))}var u=express.Router();return u.get("/getTracks",function(t,e,r){var o=null;return t.query.roundId&&(o={round:{roundId:t.query.roundId}}),n(o,null,null).then(function(n){return a(e,"grocRound-admin",!0,null,{foundTracks:n,innerContext:"get-tracks"})}).catch(function(n){return a(e,"grocRound-admin",!1,null,{innerContext:"get-tracks"})})}),u.get("/getTrack/:trackId",function(n,e,r){return n.params.trackId?t(n.params.trackId).then(function(n){return a(e,"grocRound-admin",!0,null,{foundTrack:n,innerContext:"get-track"})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?a(e,"grocRound-admin",!1,"Couldn't find track",{innerContext:"get-track"}):a(e,"grocRound-admin",!1,null,{innerContext:"get-track"})}):a(e,"grocRound-admin",!1,"Track ID is missing",{innerContext:"get-track"})}),u.post("/addTrack",function(n,t,r){if(d(n))return a(t,"grocRound-admin",!1,"Something is wrong with the data you sent",{innerContext:"add-track"});var o={round:n.body.round,trackName:n.body.trackName,contributions:n.body.contributions,adminFeePercentage:n.body.adminFeePercentage,products:{num:0,value:0}};return e(o).then(function(n){return a(t,"grocRound-admin",!0,null,{addedTrack:n,innerContext:"add-track"})}).catch(function(n){return a(t,"grocRound-admin",!1,null,{innerContext:"add-track"})})}),u.post("/updateTrack/:trackId",function(n,t,e){if(!n.params.trackId)return a(t,"grocRound-admin",!1,"Update id is missing",{innerContext:"update-track"});if(i(n))return a(t,"grocRound-admin",!1,"Something is wrong with the data you sent",{innerContext:"update-track"});var o={};return n.body.trackName&&(o.trackName=n.body.trackName),n.body.contributions&&(o.contributions=n.body.contributions),n.body.adminFeePercentage&&(o.adminFeePercentage=n.body.adminFeePercentage),r(n.params.trackId,o).then(function(n){return a(t,"grocRound-admin",!0,null,{updatedTrack:n,innerContext:"update-track"})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?a(t,"grocRound-admin",!1,"Couldn't find track",{innerContext:"update-track"}):a(t,"grocRound-admin",!1,null,{innerContext:"update-track"})})}),u.get("/deleteTrack/:trackId",function(n,t,e){return n.params.trackId?o(n.params.trackId).then(function(n){return a(t,"grocRound-admin",!0,null,{innerContext:"delete-track"})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?a(t,"grocRound-admin",!1,"Couldn't find track",{innerContext:"delete-track"}):a(t,"grocRound-admin",!1,null,{innerContext:"delete-track"})}):a(t,"grocRound-admin",!1,"Track ID is missing",{innerContext:"delete-track"})}),u};