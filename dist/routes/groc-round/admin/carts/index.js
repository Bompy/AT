"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var express=require("express"),coreValidationUpdate=require("../../../core/validation-update"),validationUpdate=require("../../validation-update");exports.default=function(n,e,t,r){function a(n){return!!coreValidationUpdate.user(n)||(!!validationUpdate.round(n)||!(!n.body.adminFeePercentage||"number"==typeof n.body.adminFeePercentage))}var d=express.Router();return d.get("/getCarts",function(e,t,a){var d={};return e.query.userId&&(d.user={userId:e.query.userId}),e.query.roundId&&(d.round={roundId:e.query.roundId}),n(d,null,null).then(function(n){return r(t,"grocRound-admin",!0,null,{foundCarts:n,innerContext:"get-carts"})}).catch(function(n){return r(t,"grocRound-admin",!1,null,{innerContext:"get-carts"})})}),d.get("/getCart/:cartId",function(n,t,a){return n.params.cartId?e(n.params.cartId).then(function(n){return r(t,"grocRound-admin",!0,null,{foundCart:n,innerContext:"get-cart"})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?r(t,"grocRound-admin",!1,"Couldn't find cart",{innerContext:"get-cart"}):r(t,"grocRound-admin",!1,null,{innerContext:"get-cart"})}):r(t,"grocRound-admin",!1,"Cart ID is missing",{innerContext:"get-cart"})}),d.post("/updateCart/:cartId",function(n,e,d){if(!n.params.cartId)return r(e,"grocRound-admin",!1,"Cart ID is missing",{innerContext:"update-cart"});if(a(n))return r(e,"grocRound-admin",!1,"Something is wrong with the data you sent",{innerContext:"update-cart"});var u={};return n.body.user&&(u.user=n.body.user),n.body.round&&(u.round=n.body.round),n.body.adminFeePercentage&&(u.adminFeePercentage=n.body.adminFeePercentage),t(n.params.cartId,u).then(function(n){return r(e,"grocRound-admin",!0,null,{updatedCart:n,innerContext:"update-cart"})}).catch(function(n){return n&&n.identifier&&"DocumentNotFound"===n.identifier?r(e,"grocRound-admin",!1,"Couldn't find cart",{innerContext:"update-cart"}):r(e,"grocRound-admin",!1,null,{innerContext:"update-cart"})})}),d};